<!doctype HTML>
<html>
<head>
  <!-- build:js bower_components/webcomponentsjs/webcomponents-lite.min.js -->
  <script src='bower_components/webcomponentsjs/webcomponents-lite.js'></script>
  <!-- endbuild -->
  <link rel='import' href='assets.html'>
  <style shim-shadowdom>
    paper-button.colored {
      color: #4285f4;
    }
    paper-button[raised].colored {
      background: #4285f4;
      color: #fff;
    }
  </style>
</head>
<body unresolved class='fullbleed layout vertical'>
  <dom-module id='ts-welcome'>
    <template>
      <style>
        paper-card {
          display: flex;
          max-width: 200px;
          padding: 10px;
          margin: auto;
          @apply(--layout-center);
        }
      </style>
      <div>
        <center><p>Welcome to TimeShift! We can see that you're not currently logged in.</p></center>
        <paper-card>
          <div><paper-button raised on-click='switchLogin'>Login</paper-button></div>
          <div><paper-button raised on-click='switchSignup'>Signup</paper-button></div>
        </paper-card>
      </div>
    </template>
    <script>
      /* global landing */
      /* exported switchSignup */
      Polymer({
        is: 'ts-welcome',
        // Load the login page
        switchLogin: function() {
          landing.welcomeRoute='login';
        },
	      switchSignup: function() {
	        landing.welcomeRoute='signup';
        }
      });
    </script>
  </dom-module>
  <dom-module id='ts-login'>
    <template>
      <form is='iron-form' id='loginForm' method='post' 
	      action='https://zyxk3wqzue.execute-api.us-east-1.amazonaws.com/prod/login'
	      on-response='testing'>

        <paper-input name='email' label='Email' required></paper-input>
        <paper-input type ='password' name='password' label='Password' required></paper-input>
        <div><paper-button raised on-click='submitForm'>Log in</paper-button>
          <paper-button raised on-click='switchWelcome'>Back</paper-button></div>
      </form>
    </template>
    <script>
      Polymer({
        is: 'ts-login',
        ready: function(){
          this.$.loginForm.addEventListener('iron-form-response',function(data){
            var token = data.detail;
            console.log('Recvd token: ', token); //TODO: remove
            //TODO: validate token
            // Set token
            localStorage.setItem('tsToken', JSON.stringify(token));
            // Debug logging
            console.log('Token: ', localStorage.getItem('tsToken'));
            // Load main website
            window.location = '/';
          });
        },
        switchWelcome: function() {
          landing.welcomeRoute='welcome';
        },
        submitForm: function() {
          this.$.loginForm.submit();
        }
      });
    </script>
  </dom-module>
  <dom-module id='ts-signup'>
     <template>
        <form is='iron-form' id='signupForm' method='post' 
          action='https://zyxk3wqzue.execute-api.us-east-1.amazonaws.com/prod/login'>
          
          <paper-input name='first' label='First' required></paper-input>
	        <paper-input name='last' label='Last' required></paper-input>
          <paper-input name='rin' label='RIN' required></paper-input>
          <paper-input name='email' label='Email' required></paper-input>
          <paper-input type ='password' name='password' label='Password' required>
          </paper-input>
	        <paper-input type ='password' name='confirm' label='Confim Password' required>
          </paper-input>
          <paper-input name='crn' label='Class CRNs, seperated by a space' required >
          </paper-input>
          <div><paper-button raised on-click='submitForm'>Sign Up</paper-button>
          <paper-button raised on-click='switchWelcome'>Back</paper-button></div>
        </form>
    </template>
    <script>
      Polymer({
        is: 'ts-signup',
        switchWelcome: function() {
          landing.welcomeRoute='welcome';
	      },
        submitForm: function() {
          document.getElementById('signupForm').submit();
        }
      });
    </script>
  </dom-module>
  <template is='dom-bind' id='landing'>
    <paper-toolbar id='mainToolbar' class='tall'>
      <div class='center horizontal layout'>
        <div class='app-name'>TimeShift</div>
      </div>
    </paper-toolbar>
    <iron-pages id='welcomeRouter' attr-for-selected='data-route' selected='{{welcomeRoute}}'>
      <section data-route='welcome'>
        <ts-welcome></ts-welcome>
      </section>
      <section data-route='login'>
        <ts-login></ts-login>
      </section>
      <section data-route='signup'>
        <ts-signup></ts-signup>
      </section>
    </iron-pages>
  </template>
  <!-- Load the welcome page by default -->
  <script>
    window.addEventListener('WebComponentsReady', function() {
      landing.welcomeRoute='welcome';
    });
  </script>
</body>
</html>
